<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2025-02-21" />

<title>Event tracking: predict analysis timepoints for ongoing clinical trials</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
margin-bottom: 0em;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Event tracking: predict analysis timepoints
for ongoing clinical trials</h1>
<h4 class="author">Kaspar Rufibach</h4>
<address class="author_afil">
PD Data Sciences, Methods, Collaboration, and Outreach Group (MCO),
Roche Basel<br><h4 class="date">21 Feb 2025</h4>



<div id="acknowledgments" class="section level1">
<h1>Acknowledgments</h1>
<p>I thank Marcel Wolbers and Godwin Yung for a careful review an
earlier version of this document and helpful comments.</p>
</div>
<div id="purpose" class="section level1">
<h1>Purpose</h1>
<p>This tutorial outlines how one can predict an interim (IA) or final
analysis (FA) clinical cutoff date (CCOD) in an <strong>ongoing</strong>
trial, i.e.Â in a trial where</p>
<ul>
<li>patients have already been recruited but have not yet experienced
the event and/or</li>
<li>patients have already been recruited and have already experienced
the event and/or</li>
<li>further patients will be recruited in the future.</li>
</ul>
<p>Methodology has been implemented in the <a href="https://cran.r-project.org/">R</a> package <em>eventTrack</em>
(<span class="citation">Rufibach (2021)</span>). Please note that the
<code>R</code> code included in this document has <strong>not</strong>
been formally validated.</p>
</div>
<div id="resources-and-how-to-cite-eventtrack" class="section level1">
<h1>Resources and how to cite eventTrack</h1>
<ul>
<li>Citation of the R package:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">citation</span>(<span class="st">&quot;eventTrack&quot;</span>)</span></code></pre></div>
<pre><code>## Um Paket &#39;eventTrack&#39; in Publikationen zu zitieren, nutzen Sie bitte:
## 
##   Rufibach K (2025). _eventTrack: Event Prediction for Time-to-Event
##   Endpoints_. R package version 1.0.4.
## 
## Ein BibTeX-Eintrag fÃ¼r LaTeX-Benutzer ist
## 
##   @Manual{,
##     title = {eventTrack: Event Prediction for Time-to-Event Endpoints},
##     author = {Kaspar Rufibach},
##     year = {2025},
##     note = {R package version 1.0.4},
##   }</code></pre>
<ul>
<li>Citation of the statistical methods used in eventTrack: the
implemented methodology for the point prediction is taken from <span class="citation">Fang and Su (2011)</span>.</li>
<li>The confidence intervals have been presented in a talk (<a href="https://baselbiometrics.github.io/home/docs/talks/20160428/1_Rufibach.pdf">slides</a>)
within a BBS seminar, <span class="citation">Rufibach
(2016)</span>.</li>
</ul>
</div>
<div id="challenge" class="section level1">
<h1>Challenge</h1>
<p>For a RCT with <strong>time-to-event</strong> endpoint we have
that:</p>
<ul>
<li>A part of patients is already accrued, another part is still to be
accrued.</li>
<li>We plan an IA or FA after a <strong>pre-specified number of
events</strong>.</li>
</ul>
<p>The questions we want to answer are:</p>
<ul>
<li>When does this number of events happen?</li>
<li>Can we assign a confidence interval around that timepoint?</li>
<li>On a more strategic level: how can we manage the potentially large
uncertainty of our point estimates in clinical teams (and higher
up)?</li>
</ul>
</div>
<div id="methodology" class="section level1">
<h1>Methodology</h1>
<p>For simplicity, assume for now only blinded data pooling the
treatment arms is available. What we are interested in is the expected
number of events, <span class="math inline">\(m(T, S)\)</span>, at a
given timepoint <span class="math inline">\(T\)</span>. This quantity
depends, of course, on the timepoint <span class="math inline">\(T\)</span> and on the survival function at which
events happen. If these two quantities are known, we can predict <span class="math inline">\(m\)</span> using the following formula:</p>
<p><span class="math display">\[
  m(t, S) = {\color{blue}\sum_{h \in {\cal{I}}_1} 1} \ + \
           {\color{brown}\sum_{j \in {\cal{I}}_2}P\Big(\text{event in
}(t_j, T] | \text{no event up to }t_j\Big)} \ + \
           {\color{red}\sum_{j \in {\cal{I}}_3} P\Big(\text{event in
}(a_i, T]\Big)} \\
       = {\color{blue}n} \ + \
           {\color{brown}\sum_{j \in {\cal{I}}_2} \frac{S(t_j) -
S(T)}{S(t_j)} 1\{T &gt; t_j\}} \ + \
           {\color{red}\sum_{j \in {\cal{I}}_3} \Big(1 - S(T - a_i)\Big)
1\{T &gt; a_i\}}.
\]</span> This formula defines the following sets of patients:</p>
<ul>
<li><span class="math inline">\({\color{blue}{\cal{I}}_1}\)</span>:
patients who already had the event, <span class="math inline">\(n\)</span>.</li>
<li><span class="math inline">\({\color{brown}{\cal{I}}_2}\)</span>:
patients who are censored at <span class="math inline">\(t_j\)</span>.</li>
<li><span class="math inline">\({\color{red}{\cal{I}}_3}\)</span>:
patients to be recruited at <span class="math inline">\(a_i\)</span>.</li>
</ul>
<p>So, in order to compute <span class="math inline">\(m(T, S)\)</span>
we need to specify two things:</p>
<ul>
<li>a projection of when the remaining patients will be recruited,
i.e.Â we need to specify the numbers <span class="math inline">\(a_i\)</span>,</li>
<li>what to plug in for <span class="math inline">\(S\)</span>.</li>
</ul>
<p>Ideally, for <span class="math inline">\(S\)</span> we would like to
use a nonparametric estimate, such as e.g.Â Kaplan-Meier. However, the
estimator of <span class="math inline">\(S\)</span> needs to be defined
at least up to the timepoint <span class="math inline">\(T\)</span>,
which typically is (much) later than the maximally observed event or
censoring time at the cleaning milestone. This means we need an estimate
of <span class="math inline">\(S\)</span> that
<strong>extrapolates</strong> beyond where we have data available. <span class="citation">Fang and Su (2011)</span> propose to use a hybrid
parametric / non-parametric estimate. In a first step, change points in
the survival function (or alternatively formulated, breaks in the
piecewise constant hazard) are detected. Secondly, the survival function
before the last change point is estimated non-parametrically via
Kaplan-Meier and the tail beyond the last change point is estimated
parametrically, i.e.Â based on an exponential distribution.</p>
<p>How to infer the changepoint via sequential testing is described in
<span class="citation">Fang and Su (2011)</span>, based on the method
initially described in <span class="citation">Goodman, Li, and Tiwari
(2011)</span>. It works as follows:</p>
<ol style="list-style-type: decimal">
<li>Determine the maximal number of changepoints, <span class="math inline">\(K\)</span>. <span class="math inline">\(K =
5\)</span> generally works well.</li>
<li>Estimate a piecewise exponential hazard function with <span class="math inline">\(K\)</span> changepoints and hazard values <span class="math inline">\(\alpha_1, \ldots, \alpha_{K + 1}\)</span>.
Cutpoints <span class="math inline">\(\tau_1, \ldots, \tau_K\)</span>
are estimated as well.</li>
<li>Start with the model with no change points and perform a hypothesis
test to compare it with the model with one change point. If we fail to
reject the null hypothesis, then we stop and conclude that the final
model has no change points.</li>
<li>If we reject the null hypothesis, then we will continue on to the
next hypothesis test; compare the model with one change point, to the
model with two change points. If the null hypothesis is rejected we test
the subsequent hypothesis. That is, we will test for the existence of
<span class="math inline">\(\tau_k\)</span> only after verifying the
existence of <span class="math inline">\(\tau_{k-1}\)</span>. The
algorithm is continued until we fail to reject a hypothesis.</li>
<li>To control for overfitting the significance level is adjusted using
an <span class="math inline">\(\alpha\)</span>-spending function. For a
familywise error rate of <span class="math inline">\(\alpha\)</span>,
<span class="citation">Goodman, Li, and Tiwari (2011)</span> propose to
use the local significance levels <span class="math inline">\(\alpha^*_k, k = 1, \ldots, K\)</span> defined as
<span class="math display">\[
  \alpha^*_k = \alpha / 2^{k-1}.
\]</span> In order to find a parsimonious model, this spending function
requires strong evidence for choosing a more complicated model, a model
with more change points, over a simpler one. Since the spending function
is decreasing, the test for each additional change point will be
conducted at a more conservative local significance level than the one
before it. That this spending function maintains the familywise error
rate is shown in <span class="citation">Goodman, Li, and Tiwari
(2011)</span>.</li>
</ol>
</div>
<div id="example-simulating-data-and-detailed-prediction" class="section level1">
<h1>Example: simulating data and detailed prediction</h1>
<p>In order to make event predictions, a sufficiently clean dataset
including accrual times and the relevant time-to-event endpoint data up
to the CCOD is needed. In addition, if recruitment is not yet completed,
a prediction regarding the accrual of the remaining patient is required
as well.</p>
<p>In this section, a detailed example of all steps required for an
event prediction is provided based on simulated trial data from
<code>rpact</code>. In the next section, a simpler minimal analysis with
only the key steps is shown.</p>
<p>First, let us load the necessary packages:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># load necessary packages</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">library</span>(rpact)          <span class="co"># to simulate illustrative dataset</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">library</span>(muhaz)          <span class="co"># kernel estimate of hazard</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">library</span>(eventTrack)     <span class="co"># event tracking methodology</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">library</span>(fitdistrplus)   <span class="co"># to estimate Weibull fit</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fu">library</span>(knitr)          <span class="co"># to prettify some outputs</span></span></code></pre></div>
<div id="simulating-an-illustrative-dataset" class="section level2">
<h2>Simulating an illustrative dataset</h2>
<p>We start by illustrating how to predict the number of events of a
clinical trial over time at the design stage using
<code>rpact</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># trial details </span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># design</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">getDesignGroupSequential</span>(<span class="at">informationRates =</span> <span class="dv">1</span>, <span class="at">typeOfDesign =</span> <span class="st">&quot;asOF&quot;</span>, </span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>                                   <span class="at">sided =</span> <span class="dv">1</span>, <span class="at">alpha =</span> alpha, <span class="at">beta =</span> beta)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co"># max number of patients</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>maxNumberOfSubjects1 <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>maxNumberOfSubjects2 <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>maxNumberOfSubjects <span class="ot">&lt;-</span> maxNumberOfSubjects1 <span class="sc">+</span> maxNumberOfSubjects2</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co"># survival hazard</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>piecewiseSurvivalTime <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">9</span>)</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>lambda2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.04</span>, <span class="fl">0.02</span>)</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co"># effect size</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>hr <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co"># quantities that determine timing of reporting events</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>dout1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>dout2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>douttime <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>accrualTime <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>accrualIntensity <span class="ot">&lt;-</span> <span class="dv">42</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="co"># maximal sample size</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>samplesize <span class="ot">&lt;-</span> <span class="fu">getSampleSizeSurvival</span>(<span class="at">design =</span> design, <span class="at">piecewiseSurvivalTime =</span> piecewiseSurvivalTime, </span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>                        <span class="at">lambda2 =</span> lambda2, <span class="at">hazardRatio =</span> hr, <span class="at">dropoutRate1 =</span> dout1, </span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>                        <span class="at">dropoutRate2 =</span> dout2, <span class="at">dropoutTime =</span> douttime, <span class="at">accrualTime =</span> accrualTime, </span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>                        <span class="at">accrualIntensity =</span> accrualIntensity,</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>                        <span class="at">maxNumberOfSubjects =</span> maxNumberOfSubjects)  </span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>nevents <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">ceiling</span>(samplesize<span class="sc">$</span>eventsPerStage))</span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a><span class="co"># expected number of events overall and per group at 1-60 months after trial start</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">60</span> </span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>probEvent <span class="ot">&lt;-</span> <span class="fu">getEventProbabilities</span>(<span class="at">time =</span> time, </span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>    <span class="at">piecewiseSurvivalTime =</span> piecewiseSurvivalTime, <span class="at">lambda2 =</span> lambda2, </span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>    <span class="at">hazardRatio =</span> hr,</span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a>    <span class="at">dropoutRate1 =</span> dout1, <span class="at">dropoutRate2 =</span> dout2, <span class="at">dropoutTime =</span> douttime,</span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a>    <span class="at">accrualTime =</span> accrualTime, <span class="at">accrualIntensity =</span> accrualIntensity, </span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a>    <span class="at">maxNumberOfSubjects =</span> maxNumberOfSubjects)</span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a><span class="co"># extract expected number of events</span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a>expEvent <span class="ot">&lt;-</span> probEvent<span class="sc">$</span>overallEventProbabilities <span class="sc">*</span> maxNumberOfSubjects   <span class="co"># overall</span></span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a>expEventInterv <span class="ot">&lt;-</span> probEvent<span class="sc">$</span>eventProbabilities1 <span class="sc">*</span> maxNumberOfSubjects1  <span class="co"># intervention</span></span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a>expEventCtrl <span class="ot">&lt;-</span> probEvent<span class="sc">$</span>eventProbabilities2 <span class="sc">*</span> maxNumberOfSubjects2   <span class="co"># control</span></span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a><span class="co"># cumulative number of recruited patients over time</span></span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a>nSubjects <span class="ot">&lt;-</span> <span class="fu">getNumberOfSubjects</span>(<span class="at">time =</span> time, <span class="at">accrualTime =</span> accrualTime, </span>
<span id="cb4-54"><a href="#cb4-54" tabindex="-1"></a>                                 <span class="at">accrualIntensity =</span> accrualIntensity, </span>
<span id="cb4-55"><a href="#cb4-55" tabindex="-1"></a>                                 <span class="at">maxNumberOfSubjects =</span> maxNumberOfSubjects)</span>
<span id="cb4-56"><a href="#cb4-56" tabindex="-1"></a></span>
<span id="cb4-57"><a href="#cb4-57" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb4-58"><a href="#cb4-58" tabindex="-1"></a><span class="fu">plot</span>(time, nSubjects<span class="sc">$</span>numberOfSubjects, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb4-59"><a href="#cb4-59" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Number of patients and expected number of events over time&quot;</span>,</span>
<span id="cb4-60"><a href="#cb4-60" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Time from trial start (months)&quot;</span>,</span>
<span id="cb4-61"><a href="#cb4-61" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Number of patients / events&quot;</span>)</span>
<span id="cb4-62"><a href="#cb4-62" tabindex="-1"></a><span class="fu">lines</span>(time, expEvent, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb4-63"><a href="#cb4-63" tabindex="-1"></a><span class="fu">lines</span>(time, expEventCtrl, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb4-64"><a href="#cb4-64" tabindex="-1"></a><span class="fu">lines</span>(time, expEventInterv, <span class="at">col =</span> <span class="st">&quot;orange&quot;</span>)</span>
<span id="cb4-65"><a href="#cb4-65" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="dv">23</span>, <span class="at">y =</span> <span class="dv">850</span>,</span>
<span id="cb4-66"><a href="#cb4-66" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Recruitment&quot;</span>, <span class="st">&quot;Expected events - All subjects&quot;</span>,</span>
<span id="cb4-67"><a href="#cb4-67" tabindex="-1"></a>                <span class="st">&quot;Expected events - Control&quot;</span>, <span class="st">&quot;Expected events - Intervention&quot;</span>),</span>
<span id="cb4-68"><a href="#cb4-68" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;orange&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb4-69"><a href="#cb4-69" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb4-70"><a href="#cb4-70" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" tabindex="-1"></a><span class="co"># add lines with event prediction pre-trial</span></span>
<span id="cb4-72"><a href="#cb4-72" tabindex="-1"></a>fa_pred_pretrial <span class="ot">&lt;-</span> <span class="fu">exactDatesFromMonths</span>(<span class="fu">data.frame</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(expEvent) <span class="sc">-</span> <span class="dv">1</span>, expEvent), nevents)</span>
<span id="cb4-73"><a href="#cb4-73" tabindex="-1"></a><span class="fu">segments</span>(fa_pred_pretrial, <span class="dv">0</span>, fa_pred_pretrial, nevents, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb4-74"><a href="#cb4-74" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">0</span>, nevents, fa_pred_pretrial, nevents, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>For the design, we assume there is no interim analysis, implying that
we need 299 events using the specified parameters.</p>
<p>We simplified the specification of the underlying piecewise
exponential hazard function somewhat, so that at the time of the CCOD
below we have already data on all stretches of the piecewise exponential
hazard. Otherwise, it would be impossible to accurately estimate <span class="math inline">\(S\)</span>.</p>
<p>Now assume this trial is running. To generate an illustrative dataset
we simulate based on the above assumptions as follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>seed <span class="ot">&lt;-</span> <span class="dv">2020</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># generate a dataset with 1000 patients</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># administratively censor after 100 events</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co"># number of events after which to administratively censor</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>nevents_admincens <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co"># generate a dataset after the interim analysis, administratively censor after 100 events</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>trial1 <span class="ot">&lt;-</span> <span class="fu">getSimulationSurvival</span>(design,</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    <span class="at">piecewiseSurvivalTime =</span> piecewiseSurvivalTime, <span class="at">lambda2 =</span> lambda2,</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>    <span class="at">hazardRatio =</span> hr, <span class="at">dropoutRate1 =</span> dout1, <span class="at">dropoutRate2 =</span> dout2, <span class="at">dropoutTime =</span> douttime,</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>    <span class="at">accrualTime =</span> accrualTime, <span class="at">accrualIntensity =</span> accrualIntensity,</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>    <span class="at">plannedEvents =</span> nevents_admincens, <span class="at">directionUpper =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>    <span class="at">maxNumberOfSubjects =</span> maxNumberOfSubjects, <span class="at">maxNumberOfIterations =</span> <span class="dv">1</span>,</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>    <span class="at">maxNumberOfRawDatasetsPerStage =</span> <span class="dv">1</span>, <span class="at">seed =</span> seed)</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>trial2 <span class="ot">&lt;-</span> <span class="fu">getRawData</span>(trial1)</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co"># clinical cutoff date for this analysis</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>ccod <span class="ot">&lt;-</span> trial2<span class="sc">$</span>lastObservationTime[<span class="dv">1</span>]</span></code></pre></div>
<p>Assume that after 100 events we clean the dataset and want to predict
the timepoint when the final number of 299 events happens. This cleaning
milestone is reached after 14 months. The generated dataset looks as
follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(trial2, <span class="dv">10</span>)[, <span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(trial2)], <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table>
<colgroup>
<col width="8%" />
<col width="9%" />
<col width="12%" />
<col width="10%" />
<col width="9%" />
<col width="16%" />
<col width="17%" />
<col width="4%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">subjectId</th>
<th align="right">accrualTime</th>
<th align="right">treatmentGroup</th>
<th align="right">survivalTime</th>
<th align="right">dropoutTime</th>
<th align="right">lastObservationTime</th>
<th align="right">timeUnderObservation</th>
<th align="left">event</th>
<th align="left">dropoutEvent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.0238095</td>
<td align="right">1</td>
<td align="right">64.9008011</td>
<td align="right">NA</td>
<td align="right">13.99707</td>
<td align="right">13.9732632</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.0476190</td>
<td align="right">2</td>
<td align="right">20.5623950</td>
<td align="right">NA</td>
<td align="right">13.99707</td>
<td align="right">13.9494536</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.0714286</td>
<td align="right">1</td>
<td align="right">59.7432789</td>
<td align="right">NA</td>
<td align="right">13.99707</td>
<td align="right">13.9256441</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.0952381</td>
<td align="right">2</td>
<td align="right">27.8982841</td>
<td align="right">NA</td>
<td align="right">13.99707</td>
<td align="right">13.9018346</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.1190476</td>
<td align="right">1</td>
<td align="right">7.1265000</td>
<td align="right">NA</td>
<td align="right">13.99707</td>
<td align="right">7.1265000</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.1428571</td>
<td align="right">2</td>
<td align="right">2.7904861</td>
<td align="right">NA</td>
<td align="right">13.99707</td>
<td align="right">2.7904861</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.1666667</td>
<td align="right">1</td>
<td align="right">6.8596179</td>
<td align="right">NA</td>
<td align="right">13.99707</td>
<td align="right">6.8596179</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.1904762</td>
<td align="right">2</td>
<td align="right">20.4710395</td>
<td align="right">NA</td>
<td align="right">13.99707</td>
<td align="right">13.8065965</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0.2142857</td>
<td align="right">1</td>
<td align="right">0.1379221</td>
<td align="right">NA</td>
<td align="right">13.99707</td>
<td align="right">0.1379221</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.2380952</td>
<td align="right">2</td>
<td align="right">43.9063079</td>
<td align="right">NA</td>
<td align="right">13.99707</td>
<td align="right">13.7589774</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>The dataset <code>trial2</code> contains simulated event times
<em>and</em> accrual times for <strong>all</strong> patients, i.e.Â also
those patients that have been accrued <em>later</em> than 14 months.
This means that by the timepoint our event prediction happens in reality
these patients would not have been recruited yet. In our dataset, these
are 413 patients. In our event prediction, we need to take this into
account. The dataset is therefore reorganized as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co"># generate a dataset with PFS information:</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co"># - blinded to treatment assignment</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># - remove patients recruited *after* clinical cutoff date</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>pfsdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(trial2, <span class="at">subset =</span> (timeUnderObservation <span class="sc">&gt;</span> <span class="dv">0</span>), </span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>                  <span class="at">select =</span> <span class="fu">c</span>(<span class="st">&quot;subjectId&quot;</span>, <span class="st">&quot;timeUnderObservation&quot;</span>, <span class="st">&quot;event&quot;</span>))</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="fu">colnames</span>(pfsdata) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;pat&quot;</span>, <span class="st">&quot;pfs&quot;</span>, <span class="st">&quot;event&quot;</span>)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>pfsdata[, <span class="st">&quot;event&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(pfsdata[, <span class="st">&quot;event&quot;</span>])</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co"># define variables with PFS time and censoring indicator</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>pfstime <span class="ot">&lt;-</span> pfsdata[, <span class="st">&quot;pfs&quot;</span>]</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>pfsevent <span class="ot">&lt;-</span> pfsdata[, <span class="st">&quot;event&quot;</span>]</span></code></pre></div>
</div>
<div id="estimate-s" class="section level2">
<h2>Estimate <span class="math inline">\(S\)</span></h2>
<p>With this we can now estimate <span class="math inline">\(S\)</span>
based on the patients already accrued and using the hybrid model. First,
let us plot the estimated piecewise constant hazard functions together
with a kernel estimate of the hazard function of the 587 patients that
already have PFS data, either with an event or censored:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># --------------------------------------------------</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co"># analyze hazard functions</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># --------------------------------------------------</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>oldpar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">las =</span> <span class="dv">0</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">las =</span> <span class="dv">1</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">5.5</span>, <span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># kernel estimate of hazard function</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>h.kernel1 <span class="ot">&lt;-</span> <span class="fu">muhaz</span>(pfstime, pfsevent)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="fu">plot</span>(h.kernel1, <span class="at">xlab =</span> <span class="st">&quot;time (months)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="at">col =</span> <span class="fu">grey</span>(<span class="fl">0.5</span>), <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;hazard function&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(pfstime)), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.06</span>))</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="fu">par</span>(<span class="at">las =</span> <span class="dv">3</span>)</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;estimates of hazard function&quot;</span>, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">line =</span> <span class="dv">4</span>)</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="fu">rug</span>(pfstime[pfsevent <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co"># MLE of exponential hazard, i.e. no changepoints</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>exp_lambda <span class="ot">&lt;-</span> <span class="fu">sum</span>(pfsevent) <span class="sc">/</span> <span class="fu">sum</span>(pfstime)</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">0</span>, exp_lambda, <span class="dv">20</span>, exp_lambda, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co"># add estimated piecewise exponential hazards</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>select <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;kernel estimate of hazard&quot;</span>, <span class="st">&quot;exponential hazard&quot;</span>, </span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>                             <span class="fu">paste</span>(<span class="st">&quot;#changepoints = &quot;</span>, </span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>     select, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>), <span class="st">&quot;true hazard&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="fu">grey</span>(<span class="fl">0.5</span>), <span class="dv">2</span>, <span class="dv">3</span><span class="sc">:</span>(<span class="fu">length</span>(select) <span class="sc">+</span> <span class="dv">2</span>), <span class="dv">1</span>), </span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>     <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">2</span>, <span class="fu">length</span>(select)), <span class="dv">1</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">2</span>, <span class="fu">length</span>(select)), <span class="dv">2</span>), </span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>     <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(select)){</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>  pe1 <span class="ot">&lt;-</span> <span class="fu">piecewiseExp_MLE</span>(pfstime, pfsevent, <span class="at">K =</span> select[i])</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>  tau.i <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, pe1<span class="sc">$</span>tau, <span class="fu">max</span>(pfstime))</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>  lambda.i <span class="ot">&lt;-</span> <span class="fu">c</span>(pe1<span class="sc">$</span>lambda, <span class="fu">tail</span>(pe1<span class="sc">$</span>lambda, <span class="dv">1</span>))  </span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>  <span class="fu">lines</span>(tau.i, lambda.i, <span class="at">type =</span> <span class="st">&quot;s&quot;</span>, <span class="at">col =</span> i <span class="sc">+</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>  <span class="fu">segments</span>(<span class="fu">max</span>(tau.i), <span class="fu">tail</span>(lambda.i, <span class="dv">1</span>), <span class="dv">10</span> <span class="sc">*</span> <span class="fu">max</span>(pfstime), </span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>           <span class="fu">tail</span>(lambda.i, <span class="dv">1</span>), <span class="at">col =</span> i <span class="sc">+</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>}</span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a><span class="co"># since we simulated data we can add the truth</span></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">stepfun</span>(piecewiseSurvivalTime[<span class="sc">-</span><span class="dv">1</span>], lambda2), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>As a next step, we perform the sequential testing for detection of a
changepoint, starting from an estimated hazard with <span class="math inline">\(K = 5\)</span> changepoints:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># --------------------------------------------------</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co"># starting from a piecewise Exponential hazard with </span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co"># K = 5 change points, infer the last &quot;significant&quot;</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># change point</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co"># --------------------------------------------------</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>pe5 <span class="ot">&lt;-</span> <span class="fu">piecewiseExp_MLE</span>(<span class="at">time =</span> pfstime, <span class="at">event =</span> pfsevent, <span class="at">K =</span> <span class="dv">5</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>pe5.tab <span class="ot">&lt;-</span> <span class="fu">piecewiseExp_test_changepoint</span>(<span class="at">peMLE =</span> pe5, <span class="at">alpha =</span> <span class="fl">0.05</span>)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>cp.select <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">as.numeric</span>(pe5.tab[, <span class="st">&quot;established change point&quot;</span>])), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">subset</span>(pe5.tab, <span class="at">select =</span> <span class="fu">c</span>(<span class="st">&quot;k&quot;</span>, <span class="st">&quot;H_0&quot;</span>, <span class="st">&quot;alpha_{k-1}&quot;</span>, <span class="st">&quot;p-value&quot;</span>, <span class="st">&quot;reject&quot;</span>, </span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>                                 <span class="st">&quot;established change point&quot;</span>)), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table>
<colgroup>
<col width="4%" />
<col width="24%" />
<col width="16%" />
<col width="13%" />
<col width="9%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">k</th>
<th align="left">H_0</th>
<th align="right">alpha_{k-1}</th>
<th align="right">p-value</th>
<th align="right">reject</th>
<th align="left">established change point</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="left">lambda1 - lambda2</td>
<td align="right">0.0250000</td>
<td align="right">0.3913751</td>
<td align="right">0</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">lambda2 - lambda3</td>
<td align="right">0.0125000</td>
<td align="right">0.0098730</td>
<td align="right">1</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">lambda3 - lambda4</td>
<td align="right">0.0062500</td>
<td align="right">0.0023362</td>
<td align="right">1</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">lambda4 - lambda5</td>
<td align="right">0.0031250</td>
<td align="right">0.0943560</td>
<td align="right">0</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="left">lambda5 - lambda6</td>
<td align="right">0.0015625</td>
<td align="right">0.0408903</td>
<td align="right">0</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>Proceeding in the sequential fashion as described above no
changepoint can be established based on this data. This, because we do
not reject the first null hypothesis and thus the procedure stops,
eventhough the <span class="math inline">\(p\)</span>-value for <span class="math inline">\(k = 3, 4\)</span> are smaller than the
corresponding local significance levels. The implication of this is that
we do not select a changepoint, i.e.Â no hybrid exponential model, but
simply estimate <span class="math inline">\(S\)</span> based on a
constant hazard, i.e.Â a simple exponential model.</p>
</div>
<div id="prediction-of-the-timepoint-of-the-fa" class="section level2">
<h2>Prediction of the timepoint of the FA</h2>
<p>The selected estimator for <span class="math inline">\(S\)</span> is
the one without changepoint. With this estimated survival function we
can now proceed and predict the timepoint when the targeted 299 events
happen. To this end we will compute predicted events on a monthly grid.
For illustration we also plot the estimated piecewise exponential
survival functions with <span class="math inline">\(K = 5\)</span>
changepoints and provide the predictions based on that estimate of <span class="math inline">\(S\)</span>.</p>
<p>Note that for the prediction we now also include those patients that
will only be accrued <strong>after</strong> our CCOD, as discussed
above.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co"># projection for patients to be recruited after CCOD</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co"># 42 patients / month, and we have maxNumberOfSubjects - length(pfstime)</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co"># left to randomize. Assume they show up uniformly distributed</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co"># this accrual is relative to the CCOD</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>accrual_after_ccod <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>(maxNumberOfSubjects <span class="sc">-</span> <span class="fu">length</span>(pfstime)) <span class="sc">/</span> accrualIntensity </span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co"># Kaplan-Meier and hybrid Exponential tail fits, for different changepoints</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="fu">par</span>(<span class="at">las =</span> <span class="dv">1</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">survfit</span>(<span class="fu">Surv</span>(pfstime, pfsevent) <span class="sc">~</span> <span class="dv">1</span>), <span class="at">mark =</span> <span class="st">&quot;&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>), </span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">xaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="at">yaxs =</span> <span class="st">&quot;i&quot;</span>,</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;estimated survival functions&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;time&quot;</span>, </span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;survival probability&quot;</span>, <span class="at">col =</span> <span class="fu">grey</span>(<span class="fl">0.75</span>), <span class="at">lwd =</span> <span class="dv">5</span>)</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co"># how far out should we predict monthly number of events?</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>future.units <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> future.units)</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co"># the function predictEvents takes as an argument any survival function</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co"># hybrid exponential with cp.select</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>St1 <span class="ot">&lt;-</span> <span class="cf">function</span>(t0, time, event, cp){</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>     <span class="fu">return</span>(<span class="fu">hybrid_Exponential</span>(<span class="at">t0 =</span> t0, <span class="at">time =</span> time, <span class="at">event =</span> event, </span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>     <span class="at">changepoint =</span> cp))}</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>pe1 <span class="ot">&lt;-</span> <span class="fu">predictEvents</span>(<span class="at">time =</span> pfstime, <span class="at">event =</span> pfsevent, </span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>          <span class="at">St =</span> <span class="cf">function</span>(t0){<span class="fu">St1</span>(t0, <span class="at">time =</span> pfstime, </span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>          <span class="at">event =</span> pfsevent, cp.select)}, accrual_after_ccod, </span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>          <span class="at">future.units =</span> future.units)</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>tab[, <span class="dv">1</span>] <span class="ot">&lt;-</span> pe1[, <span class="dv">2</span>]</span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a><span class="fu">lines</span>(ts, <span class="fu">St1</span>(ts, pfstime, pfsevent, cp.select), <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a><span class="co"># for illustration add piecewise exponential with five changepoints</span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>St2 <span class="ot">&lt;-</span> <span class="cf">function</span>(t0, time, event, tau, lambda){</span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>      <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">getPiecewiseExponentialDistribution</span>(<span class="at">time =</span> t0, </span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>                        <span class="at">piecewiseSurvivalTime =</span> tau, </span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a>                        <span class="at">piecewiseLambda =</span> lambda))}</span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">predictEvents</span>(<span class="at">time =</span> pfstime, <span class="at">event =</span> pfsevent, </span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a>          <span class="at">St =</span> <span class="cf">function</span>(t0){<span class="fu">St2</span>(t0, <span class="at">time =</span> pfstime, </span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a>          <span class="at">event =</span> pfsevent, <span class="at">tau =</span> <span class="fu">c</span>(<span class="dv">0</span>, pe5<span class="sc">$</span>tau), </span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a>          <span class="at">lambda =</span> pe5<span class="sc">$</span>lambda)}, accrual_after_ccod, </span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a>          <span class="at">future.units =</span> future.units)</span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a>tab[, <span class="dv">2</span>] <span class="ot">&lt;-</span> pe2[, <span class="dv">2</span>]</span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a><span class="fu">lines</span>(ts, <span class="fu">St2</span>(ts, pfstime, pfsevent, <span class="fu">c</span>(<span class="dv">0</span>, pe5<span class="sc">$</span>tau), pe5<span class="sc">$</span>lambda), <span class="at">col =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a><span class="co"># since we have simulated data we can add the truth</span></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a>tp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="fl">0.01</span>) </span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a><span class="fu">lines</span>(tp, <span class="dv">1</span> <span class="sc">-</span> <span class="fu">getPiecewiseExponentialDistribution</span>(<span class="at">time =</span> tp, </span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a>                        <span class="at">piecewiseSurvivalTime =</span> piecewiseSurvivalTime, </span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a>                        <span class="at">piecewiseLambda =</span> lambda2), <span class="at">col =</span> <span class="dv">4</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb10-55"><a href="#cb10-55" tabindex="-1"></a>legS <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Kaplan-Meier&quot;</span>, <span class="st">&quot;hybrid exponential&quot;</span>, </span>
<span id="cb10-56"><a href="#cb10-56" tabindex="-1"></a>          <span class="st">&quot;piecewise exponential K = 5&quot;</span>, <span class="st">&quot;true S&quot;</span>)</span>
<span id="cb10-57"><a href="#cb10-57" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, legS, <span class="at">col =</span> <span class="fu">c</span>(<span class="fu">grey</span>(<span class="fl">0.75</span>), <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>), </span>
<span id="cb10-58"><a href="#cb10-58" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># prettify the output</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pe1[, <span class="dv">1</span>], <span class="fu">round</span>(tab, <span class="dv">1</span>))</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">colnames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;month&quot;</span>, legS[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>])</span></code></pre></div>
<p>Since we can compare our estimates to the truth we see that the
hybrid exponential model actually not too badly estimates this truth. It
is important to note that based on the generic formula in the methods
section above we know that the latest timepoint <span class="math inline">\(S\)</span> has to be evaluated at is the <em>time
of the last censored patient</em> + <code>future.units</code>, which in
our case amounts to 29 months, i.e.Â we have to
<strong>extrapolate</strong> 15 months beyond the last observed PFS
time! Looking at the plot of the estimated survival functions we see how
variable the various estimates are at 29 months, implying high
dependence of the predicted analysis timepoint on the selected
model.</p>
<p>In any case, based on these survival functions we then get the
following point predictions of event numbers over time:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">kable</span>(tab, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">month</th>
<th align="right">hybrid exponential</th>
<th align="right">piecewise exponential K = 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">113.7</td>
<td align="right">112.8</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">128.1</td>
<td align="right">125.8</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">143.2</td>
<td align="right">139.5</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">159.1</td>
<td align="right">153.8</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">175.7</td>
<td align="right">168.5</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">193.0</td>
<td align="right">183.5</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">210.9</td>
<td align="right">198.8</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">229.5</td>
<td align="right">214.6</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">248.7</td>
<td align="right">230.9</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">268.5</td>
<td align="right">247.6</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="right">288.2</td>
<td align="right">264.0</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">307.3</td>
<td align="right">279.6</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">326.0</td>
<td align="right">294.4</td>
</tr>
<tr class="even">
<td align="right">14</td>
<td align="right">344.1</td>
<td align="right">308.5</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="right">361.8</td>
<td align="right">322.3</td>
</tr>
</tbody>
</table>
<p>Note the sensitivity of the estimated timepoint on the estimate of
<span class="math inline">\(S\)</span> in the table above.</p>
<p>Our sequential test suggested that we use the model without a
changepoint, i.e.Â a standard exponential fit. This corresponds to the
column <code>hybrid exponential</code>. Looking at this column we find
that the targeted number of 299 events happens between time unit 11 and
12 after the current CCOD. Linearly interpolating we can get the
âpreciseâ timepoint as follows:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>fa_pred_ccod <span class="ot">&lt;-</span> <span class="fu">exactDatesFromMonths</span>(tab[, <span class="fu">c</span>(<span class="st">&quot;month&quot;</span>, <span class="st">&quot;hybrid exponential&quot;</span>)], nevents)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>fa_pred_ccod</span></code></pre></div>
<pre><code>## [1] 11.56545</code></pre>
<p>On the timescale of trial start we need to add the CCOD to get:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>fa_pred_ccod <span class="sc">+</span> ccod</span></code></pre></div>
<pre><code>## [1] 25.56252</code></pre>
<p>Now, let us compare our prediction of when 299 events happen with
what we predicted before starting the trial. As we are blinded once the
trial started we only re-plot the initial prediction for the entire
trial, not separate per arm.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co"># plot event predictions pre-trial and after CCOD</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="fu">par</span>(<span class="at">las =</span> <span class="dv">1</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="fu">plot</span>(time, nSubjects<span class="sc">$</span>numberOfSubjects, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="fu">grey</span>(<span class="fl">0.75</span>), </span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Number of patients and expected number of events over time&quot;</span>,</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Time from trial start (months)&quot;</span>,</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Number of patients / events&quot;</span>)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co"># expected events at design stage</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="fu">lines</span>(time, expEvent, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co"># patients already recruited</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>tot_accrual1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(trial2, <span class="at">select =</span> <span class="st">&quot;accrualTime&quot;</span>, <span class="at">subset =</span> timeUnderObservation <span class="sc">&gt;</span> <span class="dv">0</span>)[, <span class="dv">1</span>]</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co"># add those that will only be recruited after CCOD</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>tot_accrual <span class="ot">&lt;-</span> <span class="fu">c</span>(tot_accrual1, accrual_after_ccod <span class="sc">+</span> ccod)</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>tot_accrual_unit <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">table</span>(<span class="fu">cut</span>(tot_accrual, <span class="dv">0</span><span class="sc">:</span><span class="dv">59</span>, <span class="at">labels =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="co"># actually not much to see, b/c simulated data perfectly uniform</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tot_accrual_unit), tot_accrual_unit, <span class="at">col =</span> <span class="dv">1</span>) </span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="co"># now add event prediction based on hybrid exponential and 100 events</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="fu">lines</span>(tab<span class="sc">$</span>month <span class="sc">+</span> ccod, tab[, <span class="st">&quot;hybrid exponential&quot;</span>], <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="co"># add lines with prediction based on CCOD data</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="fu">segments</span>(fa_pred_ccod <span class="sc">+</span> ccod, <span class="dv">0</span>, fa_pred_ccod <span class="sc">+</span> ccod, nevents, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">0</span>, nevents, fa_pred_ccod <span class="sc">+</span> ccod, nevents, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a><span class="co"># finally, we add observed events over time</span></span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a><span class="co"># note the x-axis of the plot (time from trial start), so we need to add accrual time</span></span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a>events_trial_time <span class="ot">&lt;-</span> <span class="fu">sort</span>((pfstime <span class="sc">+</span> tot_accrual1)[pfsevent <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">stepfun</span>(events_trial_time, <span class="dv">0</span><span class="sc">:</span><span class="fu">sum</span>(pfsevent)), <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="dv">20</span>, <span class="at">y =</span> <span class="dv">930</span>, <span class="fu">c</span>(<span class="st">&quot;Planned recruitment at design stage&quot;</span>, </span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a>                          <span class="st">&quot;Recruitment (up to CCOD + prediction)&quot;</span>, </span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a>                          <span class="st">&quot;Expected events at design stage&quot;</span>, </span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a>                          <span class="st">&quot;Observed events&quot;</span>, </span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a>                          <span class="st">&quot;Expected events (after CCOD prediction)&quot;</span>),</span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="fu">grey</span>(<span class="fl">0.75</span>), <span class="dv">1</span>, <span class="dv">4</span>, <span class="st">&quot;orange&quot;</span>, <span class="dv">2</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>), </span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># revert back to initial plot parameters</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">par</span>(oldpar)</span></code></pre></div>
<p>So, before the trial started, based on our initial assumptions, we
predicted that 299 events would happen after 28.6 months. Our updated
prediction after 100 events is now 25.6 months, using the hybrid
exponential approach. This prediction is actually quite accurate, taking
into account that it relies on only 100 patients with event out of 1000
patients. We have also added the actually observed events over time. As
we simulate from the truth the observation is very close to the
expectation - <strong>this might not be the case in an actual
trial</strong>.</p>
<p>In general, event predictions come with high variability, see also
the strategic discussion below. Note that we have (at least) two sources
of variability:</p>
<ul>
<li>Accrual of the 413 patients still to be accrued is only a
projection.</li>
<li>Variability in estimation of <span class="math inline">\(S\)</span>.</li>
</ul>
<p>Using bootstrap we can easily quantify the uncertainty in estimation
of <span class="math inline">\(S\)</span>, for a fixed accrual
projection:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co"># compute a confidence interval for our event prediction using bootstrap</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co"># do not run as takes a few minutes, code only here for illustration</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="cf">if</span> (<span class="dv">1</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>boot1 <span class="ot">&lt;-</span> <span class="fu">bootstrapTimeToEvent</span>(<span class="at">time =</span> pfstime, <span class="at">event =</span> pfsevent, </span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>          <span class="at">interim.gates =</span> nevents, <span class="at">future.units =</span> <span class="dv">20</span>, <span class="at">n =</span> <span class="fu">length</span>(pfstime), </span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>          <span class="at">M0 =</span> <span class="dv">1000</span>, <span class="at">K0 =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">accrual =</span> accrual_after_ccod, <span class="at">seed =</span> <span class="dv">2020</span>)</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot1<span class="sc">$</span>event.dates[, <span class="dv">1</span>], <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>}</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co"># hard-code result and add ccod</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">10.26989</span>, <span class="fl">12.50578</span>) <span class="sc">+</span> ccod</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>ci</span></code></pre></div>
<pre><code>## [1] 24.26696 26.50285</code></pre>
<p>So a 95% confidence interval around our predicted CCOD for the final
analysis, 25.6 months, ranges from 24.3 to 26.5 months. Note that we
implement the entire model selection algorithm into the bootstrap,
i.e.Â the changepoint is determined individually for every bootstrap
sample.</p>
</div>
<div id="using-parametric-weibull-instead-of-hybrid-exponential-estimate" class="section level2">
<h2>Using parametric Weibull instead of hybrid exponential estimate</h2>
<p>If instead the hybrid exponential model we would like to use, e.g., a
parametric model such as Weibull, we can proceed as follows:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co"># event prediction based on pure Weibull assumption</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co"># prepare dataset to fit function &quot;fitdistcens&quot;</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>pfsdata2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="st">&quot;left&quot;</span> <span class="ot">=</span> pfstime, <span class="st">&quot;right&quot;</span> <span class="ot">=</span> pfstime))</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>pfsdata2[pfsevent <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;right&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="co"># estimate parameters based on Weibull distribution</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>fit_weibull <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">fitdistcens</span>(pfsdata2, <span class="st">&quot;weibull&quot;</span>))</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="co"># event prediction based on this estimated survival function</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="co"># simply specify survival function based on above fit</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>pred_weibull <span class="ot">&lt;-</span> <span class="fu">predictEvents</span>(<span class="at">time =</span> pfstime, <span class="at">event =</span> pfsevent, </span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>                      <span class="at">St =</span> <span class="cf">function</span>(t0){<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pweibull</span>(t0, </span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>                                                     <span class="at">shape =</span> fit_weibull<span class="sc">$</span>estimate[<span class="st">&quot;shape&quot;</span>], </span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>                                                     <span class="at">scale =</span> fit_weibull<span class="sc">$</span>estimate[<span class="st">&quot;scale&quot;</span>])}, </span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>                      <span class="at">accrual =</span> accrual_after_ccod, <span class="at">future.units =</span> future.units)</span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>ccod_weibull <span class="ot">&lt;-</span> <span class="fu">exactDatesFromMonths</span>(pred_weibull, nevents)</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>ccod_weibull</span></code></pre></div>
<pre><code>## [1] 12.27657</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>ccod_weibull <span class="sc">+</span> ccod</span></code></pre></div>
<pre><code>## [1] 26.27364</code></pre>
<p>So the predicted CCOD for the FA based on a Weibull fit amounts to
26.3, very similar to what we receive based on the hybrid exponential
model.</p>
</div>
</div>
<div id="example-minimal-analysis" class="section level1">
<h1>Example: minimal analysis</h1>
<p>This section collects the code that is minimally needed to get to a
timepoint of a prediction, without the above more detailed
discussion.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="co"># input data (e.g. OS or PFS)</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co"># we use the data simulated above</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co"># alternatively, simply use</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co"># pfsdata &lt;- read.csv(&quot;C:/my path/pfs.csv&quot;)</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co"># --------------------------------------------------</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co"># accrual after ccod</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>accrual_after_ccod <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>(maxNumberOfSubjects <span class="sc">-</span> <span class="fu">length</span>(pfstime)) <span class="sc">/</span> accrualIntensity </span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="co"># infer changepoint</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>pe5 <span class="ot">&lt;-</span> <span class="fu">piecewiseExp_MLE</span>(<span class="at">time =</span> pfstime, <span class="at">event =</span> pfsevent, <span class="at">K =</span> <span class="dv">5</span>)</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>pe5.tab <span class="ot">&lt;-</span> <span class="fu">piecewiseExp_test_changepoint</span>(<span class="at">peMLE =</span> pe5, <span class="at">alpha =</span> <span class="fl">0.05</span>)</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>cp.selected <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">max</span>(<span class="fu">as.numeric</span>(pe5.tab[, <span class="st">&quot;established change point&quot;</span>]), </span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>                                             <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>cp.selected <span class="ot">&lt;-</span> <span class="fu">max</span>(cp.selected, <span class="dv">0</span>)</span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a><span class="co"># compute predictions for selected hybrid exponential model, i.e. chosen changepoint</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>future.units <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>St1 <span class="ot">&lt;-</span> <span class="cf">function</span>(t0, time, event, cp){</span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>     <span class="fu">return</span>(<span class="fu">hybrid_Exponential</span>(<span class="at">t0 =</span> t0, <span class="at">time =</span> time, <span class="at">event =</span> event, </span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>     <span class="at">changepoint =</span> cp))}</span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>pe1 <span class="ot">&lt;-</span> <span class="fu">predictEvents</span>(<span class="at">time =</span> pfstime, <span class="at">event =</span> pfsevent, </span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>          <span class="at">St =</span> <span class="cf">function</span>(t0){<span class="fu">St1</span>(t0, <span class="at">time =</span> pfstime, </span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a>          <span class="at">event =</span> pfsevent, cp.selected)}, accrual_after_ccod, </span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>          <span class="at">future.units =</span> future.units)</span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a><span class="co"># find exact timepoint when targeted number of events are reached through linear interpolation</span></span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a><span class="co"># add computation of confidence interval using code from just above</span></span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>fa_pred_ccod <span class="ot">&lt;-</span> <span class="fu">exactDatesFromMonths</span>(tab[, <span class="fu">c</span>(<span class="st">&quot;month&quot;</span>, <span class="st">&quot;hybrid exponential&quot;</span>)], nevents)</span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a>fa_pred_ccod <span class="sc">+</span> ccod</span></code></pre></div>
<pre><code>## [1] 25.56252</code></pre>
</div>
<div id="possible-extensions" class="section level1">
<h1>Possible extensions</h1>
<p>The method implemented in <code>eventTrack</code> currently does not
account for drop-out.</p>
<p>The formula for <span class="math inline">\(m(t, S)\)</span>
introduced in the methodology section above is generic, i.e.Â remains
valid for event predictions. What potentially can be improved in a given
example is</p>
<ul>
<li>the quality of the accrual projection and</li>
<li>the extrapolation of the estimate of <span class="math inline">\(S\)</span> beyond where we have data.</li>
</ul>
<p>The hybrid exponential model is a compromise between a fully
parametric and a fully nonparametric estimation method. However, there
might potentially be better methods around for extrapolation of survival
curves. Such extrapolation is the bread-and-butter of Health Economists
and I suspect they could offer good approaches, e.g.Â using external data
to inform extrapolation (<span class="citation">Jackson et al.
(2017)</span>, <span class="citation">Guyot et al. (2017)</span>) of
Bayesian model averaging. However, the effort put in any modelling
effort has to be balanced against a potential gain in precision in
estimates. Typically, the approach described above provides âgood
enoughâ predictions in many instances.</p>
<p>What is described in this document applies to <strong>one treatment
arm</strong>, or equivalently, to prediction blinded to treatment
assignment. If you are unblinded to the treatment assignment and want to
use that information for prediction, then you can perform a separate
prediction of events per arm (potentially also using an estimation
method for <span class="math inline">\(S\)</span> that is different
between the arms) and then add these up.</p>
</div>
<div id="strategic-context" class="section level1">
<h1>Strategic context</h1>
<p>Implementing an event prediction based on data and getting the
relevant numbers, point prediction + confidence interval, out is
certainly an important aspect. However, in a drug development context
this is only the starting point. Strategic considerations are important.
Drawing from my experience I list a few aspects that I found important
in the past:</p>
<ul>
<li>Only do the above exercise on <strong>sufficiently clean
data</strong>. Predictions are worthless if many events are still
missing because of a cleaning lag.</li>
<li>This implies that I would <strong>strongly recommend</strong> not to
update projections on a regular basis, even if teams ask for it. Stick
with the pre-trial projections until you have a clean dataset for the
first time, e.g.Â at a futility interim analysis. Then only update
projections of dates of further IAs and the FA at such milestones.</li>
<li><strong>Communication is key!</strong> Explain to teams that these
point predictions come with substantial uncertainty. Often, confidence
intervals may be much wider than in the above example. Make sure the
team understands that this uncertainty is <strong>inherent to the
problem</strong>! This, because of the need for extrapolation + accrual
projections if the trial has not finished accrual yet. If a prediction
of an analysis milestone, e.g.Â the FA, has to be substantially shifted
based on updated data this does not necessarily point to an earlier
mistake by the team or the statistician, but may simply be due to
variability. See <a href="https://baselbiometrics.github.io/home/docs/talks/20160428/1_Rufibach.pdf">my
BBS talk</a> for an example.</li>
<li>If a trial is approaching a CCOD and, say, only a few events are
still missing other approaches might be more meaningful to finally
determine the CCOD, such as case-by-case analysis of all patients that
are still censored. The moving average approach described by the
oncology working group (see details below) might also be useful in that
scenario.</li>
<li>Typically, when doing prediction for PFS, investigator-PFS is more
up-to-date compared to IRC-PFS. If the latter is your primary endpoint
it might still be useful to do event prediction on Inv-PFS and then
exploit the âconcordanceâ between the two PFS variants to predict a
timepoint when the necessary number of IRC-PFS events will be reached. A
very simple example could be: at the time when you have 100 Inv-PFS
events you observe (before full IRC read-out, i.e.Â on the raw data) 80
IRC-PFS events. So if you need a prediction when 299 IRC-PFS events
happen then you could take the timepoint when you predict 100 / 80 * 299
= 374 Inv-PFS events.</li>
</ul>
</div>
<div id="other-approaches" class="section level1">
<h1>Other approaches</h1>
<div id="gestate" class="section level2">
<h2>gestate</h2>
<p>The R package <a href="https://CRAN.R-project.org/package=gestate">gestate</a>, <span class="citation">Bell (2020)</span>. The <a href="https://CRAN.R-project.org/package=gestate/vignettes/event_prediction.html">vignette</a>
describes its functions in a similar fashion as above, and also allows
to compute intervals around the prediction. As I understand it, gestate
fits several parametric models and then selects the one that âbestsâ
fits the data. For our data this is Weibull, so that we get the same
prediction as for the Weibull model above. gestate supplies confidence
intervals for the number of events at a given timepoint, but not for the
timepoint of the FA CCOD.</p>
<p>It is worth noting that - in contrast to <code>eventTrack</code> -
<code>gestate</code> can handle drop-out.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">library</span>(gestate)</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="co"># accrual: observed + predicted (observed accrual not needed when using eventTrack!)</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>tot_accrual1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(trial2, <span class="at">select =</span> <span class="st">&quot;accrualTime&quot;</span>, <span class="at">subset =</span> timeUnderObservation <span class="sc">&gt;</span> <span class="dv">0</span>)[, <span class="dv">1</span>]</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>tot_accrual <span class="ot">&lt;-</span> <span class="fu">c</span>(tot_accrual1, accrual_after_ccod <span class="sc">+</span> ccod)</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>tot_accrual_unit <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">table</span>(<span class="fu">cut</span>(tot_accrual, <span class="dv">0</span><span class="sc">:</span><span class="dv">59</span>, <span class="at">labels =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="co"># Create an RCurve incorporating both observed and predicted recruitment </span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>recruit <span class="ot">&lt;-</span> <span class="fu">PieceR</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(tot_accrual_unit)), </span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>                           <span class="fu">c</span>(tot_accrual_unit[<span class="dv">1</span>], <span class="fu">diff</span>(tot_accrual_unit))), <span class="at">ncol =</span> <span class="dv">2</span>), <span class="dv">1</span>)</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="co"># do the prediction: need to supply CCOD (ccod), number of events at CCOD (nevents_admincens), </span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="co"># and numbers at risk then (length(tot_accrual1))</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">event_prediction</span>(<span class="at">data =</span> pfsdata, <span class="at">Time =</span> <span class="st">&quot;pfs&quot;</span>, <span class="at">Event =</span> <span class="st">&quot;event&quot;</span>, </span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>                                <span class="at">censoringOne =</span> <span class="cn">FALSE</span>, <span class="at">rcurve =</span> recruit, <span class="at">max_time =</span> <span class="dv">60</span>, </span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>                                <span class="at">cond_Events =</span> nevents_admincens, </span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>                                <span class="at">cond_NatRisk =</span> <span class="fu">length</span>(tot_accrual1), </span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>                                <span class="at">cond_Time =</span> <span class="fu">ceiling</span>(ccod), <span class="at">units =</span> <span class="st">&quot;Months&quot;</span>)</span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a><span class="co"># exact date (not exactly as Weibull fit above, as cond_Time argument needs to be an integer)</span></span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a>pred_gestate <span class="ot">&lt;-</span> <span class="fu">exactDatesFromMonths</span>(predictions<span class="sc">$</span>Summary[, <span class="fu">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Predicted_Events&quot;</span>)], nevents)</span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>pred_gestate</span></code></pre></div>
<pre><code>## [1] 26.32032</code></pre>
</div>
</div>
<div id="info" class="section level1">
<h1>Info</h1>
<p>R version and packages used to generate this report:</p>
<p>R version: R version 4.4.1 (2024-06-14 ucrt)</p>
<p>Base packages: stats / graphics / grDevices / utils / datasets /
methods / base</p>
<p>Other packages: gestate / knitr / fitdistrplus / MASS / rpact /
eventTrack / muhaz / survival</p>
<p>This document was generated on 2025-02-21 at 20:14:48.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-gestate" class="csl-entry">
Bell, James. 2020. <em>Gestate: Generalised Survival Trial Assessment
Tool Environment</em>. <a href="https://CRAN.R-project.org/package=gestate">https://CRAN.R-project.org/package=gestate</a>.
</div>
<div id="ref-fang_11" class="csl-entry">
Fang, L., and Z. Su. 2011. <span>â<span class="nocase"><span>A</span>
hybrid approach to predicting events in clinical trials with
time-to-event outcomes</span>.â</span> <em>Contemp Clin Trials</em> 32
(5): 755â59.
</div>
<div id="ref-goodman_11" class="csl-entry">
Goodman, M. S., Y. Li, and R. C. Tiwari. 2011. <span>â<span class="nocase"><span>D</span>etecting multiple change points in
piecewise constant hazard functions</span>.â</span> <em>J Appl Stat</em>
38 (11): 2523â32.
</div>
<div id="ref-guyot_17" class="csl-entry">
Guyot, Patricia, Anthony E Ades, Matthew Beasley, BÃ©ranger Lueza,
Jean-Pierre Pignon, and Nicky J Welton. 2017. <span>âExtrapolation of
Survival Curves from Cancer Trials Using External Information.â</span>
<em>Medical Decision Making : An International Journal of the Society
for Medical Decision Making</em> 37 (May): 353â66. <a href="https://doi.org/10.1177/0272989X16670604">https://doi.org/10.1177/0272989X16670604</a>.
</div>
<div id="ref-jackson_17" class="csl-entry">
Jackson, Christopher, John Stevens, Shijie Ren, Nick Latimer, Laura
Bojke, Andrea Manca, and Linda Sharples. 2017. <span>âExtrapolating
Survival from Randomized Trials Using External Data: A Review of
Methods.â</span> <em>Medical Decision Making : An International Journal
of the Society for Medical Decision Making</em> 37 (May): 377â90. <a href="https://doi.org/10.1177/0272989X16639900">https://doi.org/10.1177/0272989X16639900</a>.
</div>
<div id="ref-rufibach_16" class="csl-entry">
Rufibach, Kaspar. 2016. <span>âEvent Projection: Quantify Uncertainty
and Manage Expectations of Broader Teams.â</span> Talk at BBS seminar
18th April 2016. <a href="https://baselbiometrics.github.io/home/docs/talks/20160428/1_Rufibach.pdf">https://baselbiometrics.github.io/home/docs/talks/20160428/1_Rufibach.pdf</a>.
</div>
<div id="ref-eventTrack" class="csl-entry">
âââ. 2021. <em>eventTrack: Implements Functions and Datasets for Event
Tracking</em>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
